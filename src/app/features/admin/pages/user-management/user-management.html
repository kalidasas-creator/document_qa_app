<div class="user-management-container">
  <header class="page-header">
    <h1>User Management</h1>
    <p>Manage user accounts, roles, and permissions</p>
  </header>

  <div class="content">
    @if (isLoading) {
      <div class="loading">
        <p>Loading users...</p>
      </div>
    } @else {
      @if (error) {
        <div class="error-message">
          {{ error }}
        </div>
      }

      @if (success) {
        <div class="success-message">
          {{ success }}
        </div>
      }

      <div class="users-table">
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Role</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users; track user.id) {
              <tr>
                <td>{{ user.username }}</td>
                <td>
                  @if (editingUser?.id === user.id) {
                    <select [(ngModel)]="editForm.role" class="form-select">
                      <option value="admin">Admin</option>
                      <option value="editor">Editor</option>
                      <option value="viewer">Viewer</option>
                    </select>
                  } @else {
                    <span class="badge {{ getRoleBadgeClass(user.role) }}">
                      {{ getRoleDisplayName(user.role) }}
                    </span>
                  }
                </td>
                <td>
                  @if (editingUser?.id === user.id) {
                    <select [(ngModel)]="editForm.active" class="form-select">
                      <option [value]="true">Active</option>
                      <option [value]="false">Inactive</option>
                    </select>
                  } @else {
                    <span class="badge {{ getStatusBadgeClass(user.active) }}">
                      {{ getStatusDisplayName(user.active) }}
                    </span>
                  }
                </td>
                <td>
                  @if (user.createdAt) {
                    {{ formatDate(user.createdAt) }}
                  } @else {
                    -
                  }
                </td>
                <td>
                  @if (editingUser?.id === user.id) {
                    <button class="btn btn-save" (click)="saveEdit()" [disabled]="isLoading">
                      {{ isLoading ? 'Saving...' : 'Save' }}
                    </button>
                    <button class="btn btn-cancel" (click)="cancelEdit()" [disabled]="isLoading">
                      Cancel
                    </button>
                  } @else {
                    <button class="btn btn-edit" (click)="startEdit(user)">
                      Edit
                    </button>
                  }
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="stats-section">
        <h3>User Statistics</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number">{{ users.length }}</span>
            <span class="stat-label">Total Users</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getActiveUsersCount() }}</span>
            <span class="stat-label">Active Users</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getAdminUsersCount() }}</span>
            <span class="stat-label">Admins</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getEditorUsersCount() }}</span>
            <span class="stat-label">Editors</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ getViewerUsersCount() }}</span>
            <span class="stat-label">Viewers</span>
          </div>
        </div>
      </div>
    }
  </div>
</div>
